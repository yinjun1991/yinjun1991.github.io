<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>设计模式 | 写好代码</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="设计模式我们常提到的设计模式源自 1994 年出版的 Design Patterns: Elements of Reusable Object-Oriented Software 一书。 书中用 C++ 描述了 23 种常用的软件设计模式，这些模式可以分类如下：  创建型，关注对象如何创建  工厂方法 Factory Method 抽象工厂 Abstract Factory 建造者 Builder">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="http://yinjun.github.io/2022/04/19/design_patterns/index.html">
<meta property="og:site_name" content="写好代码">
<meta property="og:description" content="设计模式我们常提到的设计模式源自 1994 年出版的 Design Patterns: Elements of Reusable Object-Oriented Software 一书。 书中用 C++ 描述了 23 种常用的软件设计模式，这些模式可以分类如下：  创建型，关注对象如何创建  工厂方法 Factory Method 抽象工厂 Abstract Factory 建造者 Builder">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-04-19T12:34:05.000Z">
<meta property="article:modified_time" content="2022-04-25T07:45:15.450Z">
<meta property="article:author" content="yinjun">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="写好代码" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">写好代码</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个平庸程序员的博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yinjun.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-design_patterns" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/04/19/design_patterns/" class="article-date">
  <time class="dt-published" datetime="2022-04-19T12:34:05.000Z" itemprop="datePublished">2022-04-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      设计模式
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><p>我们常提到的设计模式源自 1994 年出版的 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Design_Patterns">Design Patterns: Elements of Reusable Object-Oriented Software</a> 一书。</p>
<p>书中用 C++ 描述了 23 种常用的软件设计模式，这些模式可以分类如下：</p>
<ul>
<li><p>创建型，关注对象如何创建</p>
<ol>
<li>工厂方法 Factory Method</li>
<li>抽象工厂 Abstract Factory</li>
<li>建造者 Builder</li>
<li>原型 Prototype</li>
<li>单例 Singleton</li>
</ol>
</li>
<li><p>结构型</p>
<ol>
<li>适配器 Adapter</li>
<li>桥 Bridge</li>
<li>组合 Composite</li>
<li>装饰器 Decorator</li>
<li>门面 Facade</li>
<li>享元 Flyweight</li>
<li>代理 Proxy</li>
</ol>
</li>
<li><p>行为型</p>
<ol>
<li>责任链 Chain</li>
<li>命令 Command</li>
<li>解释器</li>
<li>迭代器</li>
<li>中介者</li>
<li>备忘录</li>
<li>观察者 Observer</li>
<li>状态 State</li>
<li>策略 Strategy</li>
<li>模版方法</li>
<li>访问者 Visitor</li>
</ol>
</li>
</ul>
<p>有些设计模式太常见，比如单例、迭代器。有些设计模式太偏，比如解释器、备忘录。<br>本文只会讲这些模式：工厂方法、装饰器、责任链、命令、中介者、状态、策略、访问者。</p>
<p>正文开始之前，需要说明的是：</p>
<p>有些设计模式是基于 C++&#x2F;Java 的 OOP 模式而产生的，其他语言不一定适用，或者有别的实现方式。</p>
<p>本文旨在了解设计模式的思想，而不在于形式。</p>
<p>在编码时切忌生搬硬套，明白原理，再结合自己使用的编程语言，写出 SOLID 代码才是学习设计模式的目的。</p>
<p>设计模式的目的不是减少代码数量，而是用抽象层将常变和相对不常变的代码隔开，从而收敛代码改动范围。</p>
<p>引入抽象层则会让代码量增加。这也是很多人困惑的一点，怎么本来几行的代码用了设计模式之后增长到一百多行？</p>
<h2 id="工厂方法"><a href="#工厂方法" class="headerlink" title="工厂方法"></a>工厂方法</h2><p>工厂方法是指用一个方法来构造对象，而不是直接调用构造方法。如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Benz</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Camry</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CarFactory</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Vehicle <span class="title function_">create</span><span class="params">(String brand)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;camry&quot;</span>.equals(brand)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Camry</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Benz</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// 调用构造方法</span></span><br><span class="line">    <span class="type">Vehicle</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Benz</span>();</span><br><span class="line">    <span class="comment">// 工厂方法</span></span><br><span class="line">    <span class="comment">// camry 甚至可以通过 args 传递进来</span></span><br><span class="line">    <span class="type">Vehicle</span> <span class="variable">car2</span> <span class="operator">=</span> CarFactory.create(<span class="string">&quot;camry&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为什么使用工厂方法呢？</p>
<p><strong>因为 <code>new SomeClass</code> 来构建对象本质上属于硬编码，</strong>写死了类型。</p>
<p>为了将 object 的构建和使用分开，才引入了工厂函数作为中间抽象。</p>
<p>上面的例子中，使用工厂方法之后，还可以将 CarFactory.create 的参数写在配置文件，或者通过命令行传递。这样如果需要改变车辆品牌，只需要修改配置或者参数即可，不用修改编译代码。</p>
<p>仔细想一下，工厂方法其实和下面的代码没有本质区别。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入抽象</span></span><br><span class="line"><span class="comment">// getMax 返回 int 类型</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> getMax();</span><br></pre></td></tr></table></figure>

<p>之前 MAX 是硬编码的某个值，比如 100；<br>之后引入了函数 getMax，至于 getMax 返回的值是怎么来的我们不关心，只要是 int 类型即可。<br>getMax 的角色和工厂方法是一样的。</p>
<p>工厂方法在 Go 代码中随处可见，因为 Go 不支持 <code>new SomeStruct</code> 创建 object。比如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPerson</span><span class="params">(params Params)</span></span> *Person &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Person&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><p><strong>装饰器用于增强原有的类型，而不改变暴露的接口。</strong></p>
<p>不去修改原有的类型，而是使用外挂或者是新类型。</p>
<p>如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Writer</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="title function_">write</span><span class="params">(data <span class="type">byte</span>[])</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">W</span> <span class="keyword">implements</span> <span class="title class_">Writer</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="title function_">write</span><span class="params">(data <span class="type">byte</span>[])</span> &#123;</span><br><span class="line">    <span class="comment">// ... write data</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Writer</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">W</span>();</span><br></pre></td></tr></table></figure>

<p>现在需要对 write 进行增强，比如流控、批量等特性。可以保留 W 类不变，提供新的类型。如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">W2</span> <span class="keyword">implements</span> <span class="title class_">Writer</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Writer w;</span><br><span class="line"></span><br><span class="line">  W2(Writer w) &#123;</span><br><span class="line">    <span class="built_in">this</span>.w = w;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="title function_">write</span><span class="params">(data <span class="type">byte</span>[])</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cache ...&quot;</span>);</span><br><span class="line">    w.write(data);</span><br><span class="line">    System.out.println(<span class="string">&quot;flush ...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Writer</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">W2</span>(<span class="keyword">new</span> <span class="title class_">W</span>());</span><br></pre></td></tr></table></figure>

<p>上面的代码用 W2 对 W 做了一些增强，然后将 W2 的实例暴露给变量 w。<br>对于 w 来说，自己收到的还是符合 Writer 接口的 object。</p>
<p>在支持装饰器的语言中，可以很容易的实现。比如 JavaScript：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">  <span class="comment">// clone 在其他地方实现</span></span><br><span class="line">  <span class="comment">// 将 cache 取出的数据 copy 一份</span></span><br><span class="line">  <span class="meta">@clone</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xxx) &#123;</span><br><span class="line">      <span class="keyword">return</span> xxx;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (xxx) &#123;</span><br><span class="line">      <span class="keyword">return</span> yyy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> zzz;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看上面的代码，需求是将 cache 取出的数据深 copy 一份。</p>
<p>如果不用装饰器，我们需要修改 get 方法内部的逻辑。如果逻辑复杂，比如分支众多，很容易漏掉某个 return。</p>
<p>而用装饰器这种外挂，就不需要去关心 get 方法的实现，更简单也更干净。</p>
<h2 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h2><p>责任链类似流水线，在一条流水线上可以随意增加&#x2F;删除处理环节，常用于对网络请求的处理。</p>
<p>比如 Java 的 netty，JavaScript 的 express 都是这种模式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Pipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Pipeline</span>();</span><br><span class="line"></span><br><span class="line">pipeline.add(handler1);</span><br><span class="line">pipeline.add(handler2);</span><br><span class="line">pipeline.add(handler3);</span><br><span class="line"></span><br><span class="line">pipeline.handle(request);</span><br></pre></td></tr></table></figure>

<p>使用责任链模式，我们需要仔细思考的是：</p>
<ol>
<li>handler 抽象接口的格式，入参和出参的类型，以及异常的处理。比如：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// handler 需要实现的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">  handle(Request request, Response response) <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的接口类型表示 handler 的异常由外层的 Pipeline 处理。</p>
<ol start="2">
<li>handler 的流转与中断谁来控制。这个过程可以由外层的 Pipeline 来控制，也可以由 handler 自己来。比如：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">  <span class="comment">// 调用 next 可以执行下一个 handler</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Request request, Response response, Next next)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在支持函数的语言，比如 Go 和 JavaScript 中，通常 handler 是一个函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handler1</span>(<span class="params">request, response, next</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handler2</span>(<span class="params">request, response, next</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(handler1);</span><br><span class="line">app.<span class="title function_">use</span>(handler2);</span><br></pre></td></tr></table></figure>

<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>命令模式用于将一组动作封装在一起，提供更简洁的接口。常用于事件相关的处理。</p>
<p>比如我们要依次执行 A B C 操作。那么可以把 A B C 封装成一个操作，暴露的接口如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">  <span class="comment">// 执行命令依赖的 object，或者上下文</span></span><br><span class="line">  <span class="keyword">private</span> A a;</span><br><span class="line">  <span class="keyword">private</span> B b;</span><br><span class="line">  <span class="keyword">private</span> C c;</span><br><span class="line"></span><br><span class="line">  SomeCommand(A a, B b, C c) &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = a;</span><br><span class="line">    <span class="built_in">this</span>.b = b;</span><br><span class="line">    <span class="built_in">this</span>.c = c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  execute() &#123;</span><br><span class="line">    a.doSomething();</span><br><span class="line">    b.doSomething();</span><br><span class="line">    c.doSomething();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// 封装了 A B C 的操作</span></span><br><span class="line">    <span class="type">SomeCommand</span> <span class="variable">someCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SomeCommand</span>(a, b, c);</span><br><span class="line">    someCommand.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码中本来应该由 Main.main 调用 a b c 来执行某种操作。但是现在它只需要创建 SomeCommand 命令，再执行一个方法即可。</p>
<p>通过 SomeCommand 的封装，Main.main 的逻辑变得更为清晰。在 Main.main 中增加更多的 command 也会更容易。</p>
<p>常见的应用：编辑器里复制按钮点击，需要执行复制操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复制按钮被点击了</span></span><br><span class="line"><span class="type">CopyCommand</span> <span class="variable">command</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CopyCommand</span>(editor);</span><br><span class="line"><span class="comment">// 具体的复制实现可以交给其他同学来完成</span></span><br><span class="line"><span class="comment">// 调用方不需要关心细节</span></span><br><span class="line">command.execute();</span><br></pre></td></tr></table></figure>

<h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><p>当系统中多个模块相互耦合时，可以引入一个中间抽象，然后这些模块都依赖这个中间抽象，将网状拓扑简化成星型拓扑，依赖复杂度由 M*N 变成 N+1。</p>
<p>中介者典型的应用有 MVC 架构、EventBus、MessageQueue 或者 NodeJS 的 EventEmitter。</p>
<h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><p>假设一个 object 有 N 种状态和 M 种行为，状态和行为之间互相影响。比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="comment">// 电梯暂停</span></span><br><span class="line">  Pause,</span><br><span class="line">  <span class="comment">// 电梯上下运行中</span></span><br><span class="line">  Running,</span><br><span class="line">  <span class="comment">// 电梯门开</span></span><br><span class="line">  Open;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 电梯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lift</span> &#123;</span><br><span class="line">  State state;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == State.Running) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Can&#x27;t open when running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;open...&quot;</span>);</span><br><span class="line">    state = State.Open;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == State.Running) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Can&#x27;t close when running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;close...&quot;</span>);</span><br><span class="line">    state = State.Pause;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == State.Open) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Close first&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;run...&quot;</span>);</span><br><span class="line">    state = State.Running;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">pause</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == State.Open) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Close first&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    state = State.Pause;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从上面的代码可以看到，电梯的状态和行为相互影响，都放在电梯类里。</p>
<p>目前电梯的状态和行为很少这么写问题不大，但是随着状态和行为的扩展，整个 Lift 类的代码交织在一起，会陷入失控。</p>
<p>引入状态模式可以解决扩展的问题：</p>
<ol>
<li>将每个状态拆成独立的 class，它们实现共同的接口，包括几乎所有的 Lift 行为。</li>
<li>Lift 只保存一个状态 object，而状态的流转和行为的控制则由这个 object 处理，因为每个状态知道自己的下一个状态是什么。</li>
</ol>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有 state 类需要继承</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="comment">// State 需要持有 Lift</span></span><br><span class="line">  <span class="comment">// 以便实现 lift 的状态流转</span></span><br><span class="line">  <span class="keyword">protected</span> Lift lift;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">State</span><span class="params">(Lift lift)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.lift = lift;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">pause</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OpenState 只关注 open 状态下的逻辑</span></span><br><span class="line"><span class="comment">// 这样单个 State 的逻辑就很清晰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Alread open&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Close&quot;</span>);</span><br><span class="line">    <span class="comment">// 流转到下一个状态</span></span><br><span class="line">    lift.setState(<span class="keyword">new</span> <span class="title class_">PauseState</span>(lift));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Close first&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pause</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Close first&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunningState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PauseState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lift</span> &#123;</span><br><span class="line">  <span class="comment">// 初始状态</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">State</span> <span class="variable">state</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RunningState</span>(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(State state)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.state = state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 所有行为委托给 state 处理</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">    state.open();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">    state.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    state.run();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">pause</span><span class="params">()</span> &#123;</span><br><span class="line">    state.pause();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，每个状态专注自身的逻辑。每增加一个状态，只需要增加一个对应的 State 类即可。</p>
<p>也有小小的缺点：每增加一个行为，则要修改全部的 State 类。</p>
<p>比较：你是愿意在一个大箱子里面找东西？还是愿意在分类更清晰的三个小箱子里面找东西？</p>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>设想这种场景：一份数据可能会做不同的处理。</p>
<p>这种情况下，数据一般是相对不易改变的部分，这里指的是数据的结构，而非具体的数值。对数据的处理逻辑可能会经常改变。</p>
<p>还是那句话：在不常变和常变之间做出区分，引入中间抽象把它们隔离开。</p>
<p>把数据的处理提取成接口，剥离处理方法的具体实现，这种方式被成为策略模式。</p>
<p>最简单常见的策略模式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从小到大</span></span><br><span class="line">nums.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">  <span class="comment">// 从大到小</span></span><br><span class="line">  <span class="keyword">return</span> b - a;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从大到小</span></span><br><span class="line">nums.<span class="title function_">sort</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> b - a;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>nums 数组提供了一个 sort 方法，具体怎么排序则由调用方自己决定，只要排序函数满足接口即可。</p>
<p>这样 nums 就不用提供 sortMinToMax&#x2F;sortMaxToMin 等排序方法，调用方爱怎么排序就怎么排序，自己来。</p>
<p>策略模式还有一个很经典的应用场景：消息通信中，对不同的消息做不同的处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> code;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">byte</span>[] data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对消息的处理可以抽象成共同的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">MsgHandler</span> &#123;</span><br><span class="line">  <span class="comment">// 可以处理的消息 code</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span>[] codes;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Message msg)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消息处理的实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MsgHandler404</span> <span class="keyword">extends</span> <span class="title class_">MsgHandler</span> &#123;</span><br><span class="line">  MsgHandler404() &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.codes = &#123;</span><br><span class="line">      <span class="number">404</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">    <span class="comment">// ... doSomething</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handlers</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Map&lt;Integer, List&lt;MsgHandler&gt;&gt; handlers = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// register 提供消息处理器的插拔机制</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(MsgHandler handler)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; handler.codes.length; i++) &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> handler.codes[i];</span><br><span class="line">      List&lt;MsgHandler&gt; list = handlers.get(code);</span><br><span class="line">      <span class="keyword">if</span> (list == <span class="literal">null</span>) &#123;</span><br><span class="line">        list = ArrayList&lt;MsgHandler&gt;();</span><br><span class="line">        handlers.put(code, list);</span><br><span class="line">      &#125;</span><br><span class="line">      list.add(handler);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不再使用 switch (msg.code) 的方式处理消息</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">    List&lt;MsgHandler&gt; list = handlers.get(msg.code);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">      <span class="type">MsgHandler</span> <span class="variable">handler</span> <span class="operator">=</span> list.get(i);</span><br><span class="line">      handler.handle(msg);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h2><p>访问者表示对数据的访问和处理。</p>
<p>访问者模式和策略模式有些像，都是强调数据本身与数据的处理逻辑相分离。</p>
<p>但是访问者模式通常适用于对数据做出比较复杂的处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Data data;</span><br><span class="line"></span><br><span class="line">  Visitor(Data data) &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  SomeInfo <span class="title function_">report</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ... 处理数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以把访问者看作对数据的视图，或者 PhotoShop 的蒙板。<br>圆形的蒙板展示的数据是圆形，方形的蒙板展示的数据则是方形。</p>
<p>比如对于同一份字节数据，可以解析成不同的结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ByteBuffer</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">byte</span>[] data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 bytes 解析成 uint8 类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Uint8View</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> ByteBuffer buffer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 bytes 解析成 int16 类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Int16View</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> ByteBuffer buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是本文的全部内容了，欢迎评论点赞分享，或者关注公众号【写好代码】，谢谢。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yinjun.github.io/2022/04/19/design_patterns/" data-id="cl2ef05lg00028mmt84lrbatj" data-title="设计模式" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/04/19/chrome_extension/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          chrome 插件开发入门
        
      </div>
    </a>
  
  
    <a href="/2022/04/19/forever/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">后台运行 NodeJS</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome-extensions/" rel="tag">chrome,extensions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event-passive/" rel="tag">event,passive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/forever/" rel="tag">forever</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js-this/" rel="tag">js,this</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json-schema/" rel="tag">json,schema</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewport/" rel="tag">viewport</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vitejs-vite/" rel="tag">vitejs,vite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/chrome-extensions/" style="font-size: 10px;">chrome,extensions</a> <a href="/tags/event-passive/" style="font-size: 10px;">event,passive</a> <a href="/tags/forever/" style="font-size: 10px;">forever</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/js-this/" style="font-size: 10px;">js,this</a> <a href="/tags/json-schema/" style="font-size: 10px;">json,schema</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/viewport/" style="font-size: 10px;">viewport</a> <a href="/tags/vitejs-vite/" style="font-size: 10px;">vitejs,vite</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/04/19/articles/">好文集锦</a>
          </li>
        
          <li>
            <a href="/2022/04/19/chrome_extension/">chrome 插件开发入门</a>
          </li>
        
          <li>
            <a href="/2022/04/19/design_patterns/">设计模式</a>
          </li>
        
          <li>
            <a href="/2022/04/19/forever/">后台运行 NodeJS</a>
          </li>
        
          <li>
            <a href="/2022/04/19/git/">git 常用命令</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 yinjun<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>